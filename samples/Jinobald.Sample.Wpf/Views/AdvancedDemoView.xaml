<UserControl
    x:Class="Jinobald.Sample.Wpf.Views.AdvancedDemoView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="800"
    d:DesignWidth="600"
    mc:Ignorable="d">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">

            <!--  Header  -->
            <StackPanel Margin="0,0,0,24">
                <TextBlock
                    FontSize="24"
                    FontWeight="Bold"
                    Text="Advanced Features Demo" />
                <TextBlock
                    Foreground="{DynamicResource ForegroundBrush}"
                    Opacity="0.7"
                    Text="새로 추가된 고급 기능들을 시연합니다" />
            </StackPanel>

            <!--  1. Validation Demo (ValidatableViewModelBase)  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="1. Validation (INotifyDataErrorInfo)" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        Text="ValidatableViewModelBase를 사용한 Data Annotations 검증" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!--  Email  -->
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="Email:" />
                        <TextBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="8,4"
                            Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="2"
                            VerticalAlignment="Center"
                            Foreground="Red"
                            Text="{Binding (Validation.Errors)[0].ErrorContent, RelativeSource={RelativeSource AncestorType=TextBox}}" />

                        <!--  Username  -->
                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="Username:" />
                        <TextBox
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="8,4"
                            Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" />

                        <!--  Age  -->
                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="Age:" />
                        <TextBox
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="8,4"
                            Text="{Binding Age, UpdateSourceTrigger=PropertyChanged}" />

                        <!--  Buttons  -->
                        <StackPanel
                            Grid.Row="3"
                            Grid.Column="1"
                            Margin="8,12,8,0"
                            Orientation="Horizontal">
                            <Button
                                Margin="0,0,8,0"
                                Command="{Binding ValidateAllFieldsCommand}"
                                Content="Validate All" />
                            <Button Command="{Binding ClearValidationCommand}" Content="Clear" />
                        </StackPanel>
                    </Grid>

                    <TextBlock
                        Margin="0,8,0,0"
                        FontSize="12"
                        Foreground="Green">
                        <Run Text="HasErrors: " />
                        <Run Text="{Binding HasErrors, Mode=OneWay}" />
                    </TextBlock>
                </StackPanel>
            </Border>

            <!--  2. CompositeCommand Demo  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="2. CompositeCommand" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        Text="여러 명령을 하나로 조합하여 동시에 실행" />

                    <StackPanel Orientation="Horizontal">
                        <Button
                            Margin="0,0,8,0"
                            Command="{Binding SaveProfileCommand}"
                            Content="Save Profile" />
                        <Button
                            Margin="0,0,8,0"
                            Command="{Binding SaveSettingsCommand}"
                            Content="Save Settings" />
                        <Button
                            Command="{Binding SaveAllCommand}"
                            Content="Save All (Composite)"
                            FontWeight="Bold" />
                    </StackPanel>

                    <TextBlock
                        Margin="0,12,0,4"
                        FontSize="12"
                        FontWeight="SemiBold"
                        Text="실행 로그:" />
                    <Border
                        Padding="8"
                        Background="{DynamicResource BackgroundBrush}"
                        CornerRadius="4">
                        <TextBlock
                            MinHeight="60"
                            FontFamily="Consolas"
                            FontSize="11"
                            Text="{Binding CompositeCommandLog}" />
                    </Border>
                </StackPanel>
            </Border>

            <!--  3. Event Filter Demo  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="3. Event Filter &amp; Weak Event" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        Text="이벤트 필터링 (짝수만) 및 Weak Reference 구독" />

                    <StackPanel Orientation="Horizontal">
                        <Button
                            Margin="0,0,8,0"
                            Command="{Binding PublishEventCommand}"
                            Content="Publish Event" />
                        <Button Command="{Binding ClearEventLogCommand}" Content="Clear Log" />
                    </StackPanel>

                    <TextBlock
                        Margin="0,12,0,4"
                        FontSize="12"
                        FontWeight="SemiBold"
                        Text="이벤트 로그 ([All/Weak]=모든 이벤트, [Even Only]=짝수만):" />
                    <Border
                        MaxHeight="120"
                        Padding="8"
                        Background="{DynamicResource BackgroundBrush}"
                        CornerRadius="4">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding EventLog}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock
                                            FontFamily="Consolas"
                                            FontSize="11"
                                            Text="{Binding}" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </StackPanel>
            </Border>

            <!--  4. IConfirmNavigationRequest Demo  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="4. IConfirmNavigationRequest" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        Text="페이지 이동 전 확인 다이얼로그 표시 (저장되지 않은 변경사항이 있을 때)" />

                    <StackPanel Orientation="Horizontal">
                        <Button
                            Margin="0,0,8,0"
                            Command="{Binding MarkAsChangedCommand}"
                            Content="Mark as Changed" />
                        <Button Command="{Binding SaveChangesCommand}" Content="Save Changes" />
                    </StackPanel>

                    <StackPanel Margin="0,8,0,0" Orientation="Horizontal">
                        <TextBlock VerticalAlignment="Center" Text="HasUnsavedChanges: " />
                        <TextBlock
                            VerticalAlignment="Center"
                            FontWeight="Bold"
                            Text="{Binding HasUnsavedChanges}" />
                        <TextBlock
                            Margin="8,0,0,0"
                            Foreground="Orange"
                            Text="(다른 페이지로 이동 시 확인 다이얼로그가 표시됩니다)"
                            Visibility="{Binding HasUnsavedChanges, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!--  5. Generic IDialogResult<T> Demo  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="5. Generic IDialogResult&lt;T&gt;" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        Text="강타입 데이터를 반환하는 다이얼로그" />

                    <Button
                        HorizontalAlignment="Left"
                        Command="{Binding ShowTypedDialogCommand}"
                        Content="Select User (Typed Dialog)" />

                    <TextBlock
                        Margin="0,8,0,0"
                        FontWeight="SemiBold"
                        Text="{Binding SelectedUserInfo}" />
                </StackPanel>
            </Border>

            <!--  6. IRegionMemberLifetime Demo  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="6. IRegionMemberLifetime" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        Text="Region에서 View의 수명 제어 (KeepAlive)" />

                    <CheckBox Content="KeepAlive 활성화" IsChecked="{Binding KeepAliveEnabled}" />

                    <TextBlock
                        Margin="0,8,0,0"
                        FontSize="12"
                        TextWrapping="Wrap">
                        KeepAlive=true: 다른 페이지 갔다가 돌아와도 상태 유지
                        <LineBreak />
                        KeepAlive=false: 매번 새로 생성됨
                    </TextBlock>
                </StackPanel>
            </Border>

            <!--  7. IDisposable (ViewModelBase) Info  -->
            <Border
                Margin="0,0,0,16"
                Padding="16"
                Background="{DynamicResource SurfaceBrush}"
                CornerRadius="8">
                <StackPanel>
                    <TextBlock
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="7. IDisposable (ViewModelBase)" />
                    <TextBlock
                        Margin="0,4,0,12"
                        FontSize="12"
                        Opacity="0.7"
                        TextWrapping="Wrap">
                        ViewModelBase에 DisposableCollection이 내장되어 있어
                        이벤트 구독, 타이머 등의 리소스를 자동 정리합니다.
                        이 ViewModel은 Dispose 시 이벤트 구독을 해제합니다.
                    </TextBlock>

                    <Border
                        Padding="12"
                        Background="{DynamicResource BackgroundBrush}"
                        CornerRadius="4">
                        <TextBlock
                            FontFamily="Consolas"
                            FontSize="11"
                            TextWrapping="Wrap">
                            protected override void Dispose(bool disposing)
                            <LineBreak />
                            {
                            <LineBreak />
                            if (disposing)
                            <LineBreak />
                            {
                            <LineBreak />
                            _eventAggregator.Unsubscribe(_allEventsToken);
                            <LineBreak />
                            _eventAggregator.Unsubscribe(_filteredEventsToken);
                            <LineBreak />
                            SaveAllCommand.UnregisterCommand(SaveProfileCommand);
                            <LineBreak />
                            SaveAllCommand.UnregisterCommand(SaveSettingsCommand);
                            <LineBreak />
                            }
                            <LineBreak />
                            base.Dispose(disposing);
                            <LineBreak />
                            }
                        </TextBlock>
                    </Border>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
